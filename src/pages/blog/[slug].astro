---
import Layout from '../../layouts/Layout.astro';
import Navbar from '../../components/Navbar.astro';
import Footer from '../../components/Footer.astro';
import Container from '../../components/Container.astro';
import AnimatedSection from '../../components/AnimatedSection';
import { PortableTextRenderer } from '../../lib/portableTextComponents';
import { getAllBlogPosts, getBlogPostBySlug, urlFor } from '@/lib/sanityClient';
import { formatDate } from '@/lib/utils';

export async function getStaticPaths() {
  const posts = await getAllBlogPosts();
  
  return posts.map((post: any) => ({
    params: { slug: post.slug.current },
    props: { post },
  }));
}

const { post } = Astro.props;
const imageUrl = urlFor(post.mainImage).width(1200).height(600).url();
---

<Layout
  title={`${post.title} - Blog`}
  description={post.excerpt}
  image={imageUrl}
>
  <Navbar />

  <!-- Article Header -->
  <article>
    <section class="py-20 bg-white">
      <Container>
        <div class="max-w-4xl mx-auto">
          <AnimatedSection client:load>
            <div class="mb-8">
              <h1 class="text-5xl font-bold text-neutral-900 mb-6">{post.title}</h1>
              
              <div class="flex items-center text-neutral-600 mb-6">
                <time datetime={post.publishedAt} class="text-lg">
                  {formatDate(post.publishedAt)}
                </time>
                <span class="mx-3">â€¢</span>
                <span class="text-lg">{post.author}</span>
              </div>

              {post.categories && post.categories.length > 0 && (
                <div class="flex flex-wrap gap-2">
                  {post.categories.map((category: string) => (
                    <span class="px-3 py-1 bg-primary-100 text-primary-700 rounded-full text-sm font-medium">
                      {category}
                    </span>
                  ))}
                </div>
              )}
            </div>
          </AnimatedSection>

          <AnimatedSection client:load delay={0.2}>
            <div class="relative h-96 rounded-2xl overflow-hidden shadow-2xl mb-12">
              <img
                src={imageUrl}
                alt={post.title}
                class="w-full h-full object-cover"
              />
            </div>
          </AnimatedSection>

          <AnimatedSection client:load delay={0.4}>
            <div class="prose prose-lg max-w-none">
              <PortableTextRenderer value={post.body} client:load />
            </div>
          </AnimatedSection>

          <AnimatedSection client:load delay={0.6}>
            <div class="mt-12 pt-8 border-t border-neutral-200">
              <a
                href="/blog"
                class="inline-flex items-center text-primary-600 font-medium hover:text-primary-700 transition-colors"
              >
                <svg
                  class="w-5 h-5 mr-2"
                  fill="none"
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth="2"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path d="M15 19l-7-7 7-7"></path>
                </svg>
                Back to Blog
              </a>
            </div>
          </AnimatedSection>
        </div>
      </Container>
    </section>
  </article>

  <Footer />
</Layout>
